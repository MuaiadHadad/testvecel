package com.muaiad.myapplication;

import android.util.Log;

import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.URL;

public class HttpRequest {

    public static String sendGet(String url, String authorizationHeader) throws IOException {
        URL obj = new URL(url);
        HttpURLConnection con = (HttpURLConnection) obj.openConnection();

        // Define o método da solicitação como GET
        con.setRequestMethod("GET");

        // Adiciona o cabeçalho de autorização
        con.setRequestProperty("Authorization",
                "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmcmVzaCI6ZmFsc2UsImlhdCI6MTcwNDA4MTY0MCwianRpIjoiOTI3ZjNmNGEtMGM3MC00NDRhLWJhNWYtZWE5MTk4NmU3ODg3IiwidHlwZSI6ImFjY2VzcyIsInN1YiI6MSwibmJmIjoxNzA0MDgxNjQwLCJjc3JmIjoiYjBiMWQ4N2QtY2E5NS00NzcwLWJlMzgtOGUxNmFjMjI5ZGQ0IiwiZXhwIjoxNzA0MDg1MjQwfQ.vsH0c0KAAsVIOnurjciCc4BtqbolY0TbjDNxOfHNH0k");

        // Lê a resposta
        BufferedReader in = new BufferedReader(new InputStreamReader(con.getInputStream()));
        String inputLine;
        StringBuilder response = new StringBuilder();

        while ((inputLine = in.readLine()) != null) {
            response.append(inputLine);
        }

        try {
            // Suponha que "response" seja a string que contém a resposta JSON
            JSONObject jsonResponse = new JSONObject(response.toString());

            // Obtém o array de medicamentos
            JSONArray medicamentos = jsonResponse.getJSONArray("medicamentos");

            // Itera pelos medicamentos
            for (int i = 0; i < medicamentos.length(); i++) {
                JSONObject med = medicamentos.getJSONObject(i);

                // Agora você pode acessar elementos específicos deste objeto JSON
                String nomeMedicamento = med.getString("nome");
                String dosagem = med.getString("dosagem");

                // Faça algo com os valores obtidos
                // Por exemplo, exiba-os em log
                Log.d("TAG", "Nome do Medicamento: " + nomeMedicamento);
                Log.d("TAG", "Dosagem: " + dosagem);
            }
        } catch (JSONException e) {
            e.printStackTrace();
        }

        in.close();

        return response.toString();
    }
}
